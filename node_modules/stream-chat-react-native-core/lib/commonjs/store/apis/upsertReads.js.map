{"version":3,"names":["_mapReadToStorable","require","_mapUserToStorable","_QuickSqliteClient","_createUpsertQuery","upsertReads","_ref","cid","_ref$flush","flush","reads","queries","forEach","read","user","push","createUpsertQuery","mapUserToStorable","mapReadToStorable","QuickSqliteClient","executeSqlBatch","exports"],"sources":["upsertReads.ts"],"sourcesContent":["import type { ReadResponse } from 'stream-chat';\n\nimport { mapReadToStorable } from '../mappers/mapReadToStorable';\nimport { mapUserToStorable } from '../mappers/mapUserToStorable';\nimport { QuickSqliteClient } from '../QuickSqliteClient';\nimport { createUpsertQuery } from '../sqlite-utils/createUpsertQuery';\nimport type { PreparedQueries } from '../types';\n\nexport const upsertReads = ({\n  cid,\n  flush = true,\n  reads,\n}: {\n  cid: string;\n  reads: ReadResponse[];\n  flush?: boolean;\n}) => {\n  const queries: PreparedQueries[] = [];\n\n  reads?.forEach((read) => {\n    if (read.user) {\n      queries.push(createUpsertQuery('users', mapUserToStorable(read.user)));\n    }\n\n    queries.push(\n      createUpsertQuery(\n        'reads',\n        mapReadToStorable({\n          cid,\n          read,\n        }),\n      ),\n    );\n  });\n\n  if (flush) {\n    QuickSqliteClient.executeSqlBatch(queries);\n  }\n\n  return queries;\n};\n"],"mappings":";;;;AAEA,IAAAA,kBAAA,GAAAC,OAAA;AACA,IAAAC,kBAAA,GAAAD,OAAA;AACA,IAAAE,kBAAA,GAAAF,OAAA;AACA,IAAAG,kBAAA,GAAAH,OAAA;AAGO,IAAMI,WAAW,GAAG,SAAdA,WAAWA,CAAAC,IAAA,EAQlB;EAAA,IAPJC,GAAG,GAAAD,IAAA,CAAHC,GAAG;IAAAC,UAAA,GAAAF,IAAA,CACHG,KAAK;IAALA,KAAK,GAAAD,UAAA,cAAG,IAAI,GAAAA,UAAA;IACZE,KAAK,GAAAJ,IAAA,CAALI,KAAK;EAML,IAAMC,OAA0B,GAAG,EAAE;EAErCD,KAAK,oBAALA,KAAK,CAAEE,OAAO,CAAC,UAACC,IAAI,EAAK;IACvB,IAAIA,IAAI,CAACC,IAAI,EAAE;MACbH,OAAO,CAACI,IAAI,CAAC,IAAAC,oCAAiB,EAAC,OAAO,EAAE,IAAAC,oCAAiB,EAACJ,IAAI,CAACC,IAAI,CAAC,CAAC,CAAC;IACxE;IAEAH,OAAO,CAACI,IAAI,CACV,IAAAC,oCAAiB,EACf,OAAO,EACP,IAAAE,oCAAiB,EAAC;MAChBX,GAAG,EAAHA,GAAG;MACHM,IAAI,EAAJA;IACF,CAAC,CACH,CACF,CAAC;EACH,CAAC,CAAC;EAEF,IAAIJ,KAAK,EAAE;IACTU,oCAAiB,CAACC,eAAe,CAACT,OAAO,CAAC;EAC5C;EAEA,OAAOA,OAAO;AAChB,CAAC;AAACU,OAAA,CAAAhB,WAAA,GAAAA,WAAA"}