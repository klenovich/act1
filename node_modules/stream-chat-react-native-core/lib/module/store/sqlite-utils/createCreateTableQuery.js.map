{"version":3,"names":["_schema","require","createCreateTableQuery","tableName","_tables$tableName$for","_tables$tableName$ind","columnsWithDescriptors","Object","entries","tables","columns","map","entry","_entry","_slicedToArray2","key","value","primaryKeyConstraints","primaryKey","length","join","foreignKeysConstraints","foreignKeys","k","column","referenceTable","referenceTableColumn","onDeleteAction","indexQueries","indexes","index","unique","name","concat","_toConsumableArray2","exports"],"sources":["createCreateTableQuery.ts"],"sourcesContent":["import { tables } from '../schema';\nimport type { PreparedQueries, Table } from '../types';\n\nexport const createCreateTableQuery = (tableName: Table): PreparedQueries[] => {\n  const columnsWithDescriptors = Object.entries(tables[tableName].columns).map((entry) => {\n    const [key, value] = entry;\n    return `${key} ${value}`;\n  });\n\n  const primaryKeyConstraints =\n    (tables[tableName].primaryKey || []).length > 0\n      ? [`PRIMARY KEY (${(tables[tableName].primaryKey || []).join(', ')})`]\n      : [];\n  const foreignKeysConstraints =\n    tables[tableName].foreignKeys?.map(\n      (k) =>\n        `FOREIGN KEY (${k.column}) REFERENCES ${k.referenceTable}(${\n          k.referenceTableColumn\n        }) ON DELETE ${k.onDeleteAction || 'NO ACTION'}`,\n    ) || [];\n\n  const indexQueries: PreparedQueries[] =\n    tables[tableName].indexes?.map((index) => [\n      `CREATE ${index.unique ? 'UNIQUE' : ''} INDEX IF NOT EXISTS ${\n        index.name\n      } ON ${tableName}(${index.columns.join(',')})`,\n    ]) || [];\n\n  return [\n    [\n      `CREATE TABLE IF NOT EXISTS ${tableName}(\n          ${[...columnsWithDescriptors, ...primaryKeyConstraints, ...foreignKeysConstraints].join(\n            ',\\n',\n          )}\n        );`,\n    ],\n    ...indexQueries,\n  ];\n};\n"],"mappings":";;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAGO,IAAMC,sBAAsB,GAAG,SAAzBA,sBAAsBA,CAAIC,SAAgB,EAAwB;EAAA,IAAAC,qBAAA,EAAAC,qBAAA;EAC7E,IAAMC,sBAAsB,GAAGC,MAAM,CAACC,OAAO,CAACC,cAAM,CAACN,SAAS,CAAC,CAACO,OAAO,CAAC,CAACC,GAAG,CAAC,UAACC,KAAK,EAAK;IACtF,IAAAC,MAAA,OAAAC,eAAA,aAAqBF,KAAK;MAAnBG,GAAG,GAAAF,MAAA;MAAEG,KAAK,GAAAH,MAAA;IACjB,OAAUE,GAAG,SAAIC,KAAK;EACxB,CAAC,CAAC;EAEF,IAAMC,qBAAqB,GACzB,CAACR,cAAM,CAACN,SAAS,CAAC,CAACe,UAAU,IAAI,EAAE,EAAEC,MAAM,GAAG,CAAC,GAC3C,mBAAiB,CAACV,cAAM,CAACN,SAAS,CAAC,CAACe,UAAU,IAAI,EAAE,EAAEE,IAAI,CAAC,IAAI,CAAC,OAAI,GACpE,EAAE;EACR,IAAMC,sBAAsB,GAC1B,EAAAjB,qBAAA,GAAAK,cAAM,CAACN,SAAS,CAAC,CAACmB,WAAW,qBAA7BlB,qBAAA,CAA+BO,GAAG,CAChC,UAACY,CAAC;IAAA,yBACgBA,CAAC,CAACC,MAAM,qBAAgBD,CAAC,CAACE,cAAc,SACtDF,CAAC,CAACG,oBAAoB,qBACTH,CAAC,CAACI,cAAc,IAAI,WAAW;EAAA,CAClD,CAAC,KAAI,EAAE;EAET,IAAMC,YAA+B,GACnC,EAAAvB,qBAAA,GAAAI,cAAM,CAACN,SAAS,CAAC,CAAC0B,OAAO,qBAAzBxB,qBAAA,CAA2BM,GAAG,CAAC,UAACmB,KAAK;IAAA,OAAK,cAC9BA,KAAK,CAACC,MAAM,GAAG,QAAQ,GAAG,EAAE,8BACpCD,KAAK,CAACE,IAAI,YACL7B,SAAS,SAAI2B,KAAK,CAACpB,OAAO,CAACU,IAAI,CAAC,GAAG,CAAC,OAC5C;EAAA,EAAC,KAAI,EAAE;EAEV,QACE,iCACgCjB,SAAS,qBACjC,GAAA8B,MAAA,KAAAC,mBAAA,aAAI5B,sBAAsB,GAAKW,qBAAqB,MAAAiB,mBAAA,aAAKb,sBAAsB,GAAED,IAAI,CACrF,KACF,CAAC,kBAEN,EAAAa,MAAA,KAAAC,mBAAA,aACEN,YAAY;AAEnB,CAAC;AAACO,OAAA,CAAAjC,sBAAA,GAAAA,sBAAA"}