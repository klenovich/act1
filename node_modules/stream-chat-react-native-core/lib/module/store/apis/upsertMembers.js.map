{"version":3,"names":["_mapMemberToStorable","require","_mapUserToStorable","_QuickSqliteClient","_createUpsertQuery","upsertMembers","_ref","cid","_ref$flush","flush","members","queries","forEach","member","user","push","createUpsertQuery","mapUserToStorable","mapMemberToStorable","QuickSqliteClient","executeSqlBatch","exports"],"sources":["upsertMembers.ts"],"sourcesContent":["import type { ChannelMemberResponse } from 'stream-chat';\n\nimport { mapMemberToStorable } from '../mappers/mapMemberToStorable';\nimport { mapUserToStorable } from '../mappers/mapUserToStorable';\nimport { QuickSqliteClient } from '../QuickSqliteClient';\nimport { createUpsertQuery } from '../sqlite-utils/createUpsertQuery';\nimport type { PreparedQueries } from '../types';\n\nexport const upsertMembers = ({\n  cid,\n  flush = true,\n  members,\n}: {\n  cid: string;\n  members: ChannelMemberResponse[];\n  flush?: boolean;\n}) => {\n  const queries: PreparedQueries[] = [];\n\n  members?.forEach((member) => {\n    if (member.user) {\n      queries.push(createUpsertQuery('users', mapUserToStorable(member.user)));\n    }\n\n    queries.push(\n      createUpsertQuery(\n        'members',\n        mapMemberToStorable({\n          cid,\n          member,\n        }),\n      ),\n    );\n  });\n\n  if (flush) {\n    QuickSqliteClient.executeSqlBatch(queries);\n  }\n\n  return queries;\n};\n"],"mappings":";;;;AAEA,IAAAA,oBAAA,GAAAC,OAAA;AACA,IAAAC,kBAAA,GAAAD,OAAA;AACA,IAAAE,kBAAA,GAAAF,OAAA;AACA,IAAAG,kBAAA,GAAAH,OAAA;AAGO,IAAMI,aAAa,GAAG,SAAhBA,aAAaA,CAAAC,IAAA,EAQpB;EAAA,IAPJC,GAAG,GAAAD,IAAA,CAAHC,GAAG;IAAAC,UAAA,GAAAF,IAAA,CACHG,KAAK;IAALA,KAAK,GAAAD,UAAA,cAAG,IAAI,GAAAA,UAAA;IACZE,OAAO,GAAAJ,IAAA,CAAPI,OAAO;EAMP,IAAMC,OAA0B,GAAG,EAAE;EAErCD,OAAO,oBAAPA,OAAO,CAAEE,OAAO,CAAC,UAACC,MAAM,EAAK;IAC3B,IAAIA,MAAM,CAACC,IAAI,EAAE;MACfH,OAAO,CAACI,IAAI,CAAC,IAAAC,oCAAiB,EAAC,OAAO,EAAE,IAAAC,oCAAiB,EAACJ,MAAM,CAACC,IAAI,CAAC,CAAC,CAAC;IAC1E;IAEAH,OAAO,CAACI,IAAI,CACV,IAAAC,oCAAiB,EACf,SAAS,EACT,IAAAE,wCAAmB,EAAC;MAClBX,GAAG,EAAHA,GAAG;MACHM,MAAM,EAANA;IACF,CAAC,CACH,CACF,CAAC;EACH,CAAC,CAAC;EAEF,IAAIJ,KAAK,EAAE;IACTU,oCAAiB,CAACC,eAAe,CAACT,OAAO,CAAC;EAC5C;EAEA,OAAOA,OAAO;AAChB,CAAC;AAACU,OAAA,CAAAhB,aAAA,GAAAA,aAAA"}