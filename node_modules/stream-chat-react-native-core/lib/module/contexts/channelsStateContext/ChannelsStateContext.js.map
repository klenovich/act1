{"version":3,"names":["_react","_interopRequireWildcard","require","_ActiveChannelsRefContext","_defaultBaseContextValue","_getDisplayName","_isTestEnvironment","_this","_jsxFileName","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","reducer","state","action","type","_extends6","_defineProperty2","payload","cid","value","_state$action$payload","_state$action$payload2","currentCount","subscriberCount","_state$action$payload3","_state$action$payload4","stateShallowCopy","Error","ChannelsStateContext","React","createContext","DEFAULT_BASE_CONTEXT_VALUE","ChannelsStateProvider","_ref","children","_useReducer","useReducer","_useReducer2","_slicedToArray2","dispatch","setState","useCallback","increaseSubscriberCount","decreaseSubscriberCount","useMemo","activeChannelsRef","useRef","keys","useEffect","current","createElement","Provider","__self","__source","fileName","lineNumber","columnNumber","ActiveChannelsProvider","exports","useChannelsStateContext","contextValue","useContext","isTestEnvironment","withChannelsStateContext","Component","WithChannelsStateContextComponent","props","channelsStateContext","displayName","getDisplayName"],"sources":["ChannelsStateContext.tsx"],"sourcesContent":["import React, {\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n} from 'react';\n\nimport type { DefaultStreamChatGenerics, UnknownType } from '../../types/types';\nimport { ActiveChannelsProvider } from '../activeChannelsRefContext/ActiveChannelsRefContext';\n\nimport type { ChannelContextValue } from '../channelContext/ChannelContext';\nimport type { PaginatedMessageListContextValue } from '../paginatedMessageListContext/PaginatedMessageListContext';\nimport type { ThreadContextValue } from '../threadContext/ThreadContext';\nimport type { TypingContextValue } from '../typingContext/TypingContext';\nimport { DEFAULT_BASE_CONTEXT_VALUE } from '../utils/defaultBaseContextValue';\n\nimport { getDisplayName } from '../utils/getDisplayName';\nimport { isTestEnvironment } from '../utils/isTestEnvironment';\n\nexport type ChannelState<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  members: ChannelContextValue<StreamChatGenerics>['members'];\n  messages: PaginatedMessageListContextValue<StreamChatGenerics>['messages'];\n  read: ChannelContextValue<StreamChatGenerics>['read'];\n  subscriberCount: number;\n  threadMessages: ThreadContextValue<StreamChatGenerics>['threadMessages'];\n  typing: TypingContextValue<StreamChatGenerics>['typing'];\n  watcherCount: ChannelContextValue<StreamChatGenerics>['watcherCount'];\n  watchers: ChannelContextValue<StreamChatGenerics>['watchers'];\n};\n\ntype ChannelsState<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  [cid: string]: ChannelState<StreamChatGenerics>;\n};\n\nexport type Keys = keyof ChannelState;\n\nexport type Payload<\n  Key extends Keys = Keys,\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  cid: string;\n  key: Key;\n  value: ChannelState<StreamChatGenerics>[Key];\n};\n\ntype SetStateAction<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  payload: Payload<Keys, StreamChatGenerics>;\n  type: 'SET_STATE';\n};\n\ntype IncreaseSubscriberCountAction = {\n  payload: { cid: string };\n  type: 'INCREASE_SUBSCRIBER_COUNT';\n};\ntype DecreaseSubscriberCountAction = {\n  payload: { cid: string };\n  type: 'DECREASE_SUBSCRIBER_COUNT';\n};\n\ntype Action<StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics> =\n  | SetStateAction<StreamChatGenerics>\n  | IncreaseSubscriberCountAction\n  | DecreaseSubscriberCountAction;\n\nexport type ChannelsStateContextValue<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  decreaseSubscriberCount: (value: { cid: string }) => void;\n  increaseSubscriberCount: (value: { cid: string }) => void;\n  setState: (value: Payload<Keys, StreamChatGenerics>) => void;\n  state: ChannelsState<StreamChatGenerics>;\n};\n\ntype Reducer<StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics> = (\n  state: ChannelsState<StreamChatGenerics>,\n  action: Action<StreamChatGenerics>,\n) => ChannelsState<StreamChatGenerics>;\n\nfunction reducer(state: ChannelsState, action: Action) {\n  switch (action.type) {\n    case 'SET_STATE':\n      return {\n        ...state,\n        [action.payload.cid]: {\n          ...(state[action.payload.cid] || {}),\n          [action.payload.key]: action.payload.value,\n        },\n      };\n\n    case 'INCREASE_SUBSCRIBER_COUNT': {\n      const currentCount = state[action.payload.cid]?.subscriberCount ?? 0;\n      return {\n        ...state,\n        [action.payload.cid]: {\n          ...(state[action.payload.cid] || {}),\n          subscriberCount: currentCount + 1,\n        },\n      };\n    }\n\n    case 'DECREASE_SUBSCRIBER_COUNT': {\n      const currentCount = state[action.payload.cid]?.subscriberCount ?? 0;\n\n      // If there last subscribed Channel component unsubscribes, we clear the channel state.\n      if (currentCount <= 1) {\n        const stateShallowCopy = {\n          ...state,\n        };\n\n        delete stateShallowCopy[action.payload.cid];\n\n        return stateShallowCopy;\n      }\n\n      return {\n        ...state,\n        [action.payload.cid]: {\n          ...(state[action.payload.cid] || {}),\n          subscriberCount: currentCount - 1,\n        },\n      };\n    }\n    default:\n      throw new Error();\n  }\n}\n\nconst ChannelsStateContext = React.createContext(\n  DEFAULT_BASE_CONTEXT_VALUE as ChannelsStateContextValue,\n);\n\nexport const ChannelsStateProvider = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>({\n  children,\n}: {\n  children: ReactNode;\n}) => {\n  const [state, dispatch] = useReducer(reducer as unknown as Reducer<StreamChatGenerics>, {});\n\n  const setState = useCallback((payload: Payload<Keys, StreamChatGenerics>) => {\n    dispatch({ payload, type: 'SET_STATE' });\n  }, []);\n\n  const increaseSubscriberCount = useCallback((payload: { cid: string }) => {\n    dispatch({ payload, type: 'INCREASE_SUBSCRIBER_COUNT' });\n  }, []);\n\n  const decreaseSubscriberCount = useCallback((payload: { cid: string }) => {\n    dispatch({ payload, type: 'DECREASE_SUBSCRIBER_COUNT' });\n  }, []);\n\n  const value = useMemo(\n    () => ({\n      decreaseSubscriberCount,\n      increaseSubscriberCount,\n      setState,\n      state,\n    }),\n    [state],\n  );\n\n  const activeChannelsRef = useRef(Object.keys(state));\n\n  useEffect(() => {\n    activeChannelsRef.current = Object.keys(state);\n  }, [state]);\n\n  return (\n    <ChannelsStateContext.Provider value={value as unknown as ChannelsStateContextValue}>\n      <ActiveChannelsProvider value={activeChannelsRef}>{children}</ActiveChannelsProvider>\n    </ChannelsStateContext.Provider>\n  );\n};\n\nexport const useChannelsStateContext = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>() => {\n  const contextValue = useContext(\n    ChannelsStateContext,\n  ) as unknown as ChannelsStateContextValue<StreamChatGenerics>;\n\n  if (contextValue === DEFAULT_BASE_CONTEXT_VALUE && !isTestEnvironment()) {\n    throw new Error(\n      `The useChannelStateContext hook was called outside the ChannelStateContext Provider. Make sure you have configured OverlayProvider component correctly - https://getstream.io/chat/docs/sdk/reactnative/basics/hello_stream_chat/#overlay-provider`,\n    );\n  }\n\n  return contextValue;\n};\n\nexport const withChannelsStateContext = <\n  P extends UnknownType,\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  Component: React.ComponentType<P>,\n): React.FC<Omit<P, keyof ChannelsStateContextValue<StreamChatGenerics>>> => {\n  const WithChannelsStateContextComponent = (\n    props: Omit<P, keyof ChannelsStateContextValue<StreamChatGenerics>>,\n  ) => {\n    const channelsStateContext = useChannelsStateContext<StreamChatGenerics>();\n\n    return <Component {...(props as P)} {...channelsStateContext} />;\n  };\n  WithChannelsStateContextComponent.displayName = `WithChannelsStateContext${getDisplayName(\n    Component,\n  )}`;\n  return WithChannelsStateContextComponent;\n};\n"],"mappings":"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"}