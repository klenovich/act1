{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactNativeReanimated","_native","_utils","_Spinner","_this","_jsxFileName","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","screenWidth","vw","halfScreenWidth","oneEighth","styles","StyleSheet","create","activityIndicator","alignSelf","videoPlayer","height","width","AnimatedGalleryVideo","React","memo","props","_useState","useState","_useState2","_slicedToArray2","opacity","setOpacity","attachmentId","handleEnd","handleLoad","handleProgress","index","offsetScale","paused","previous","repeat","scale","screenHeight","selected","shouldRender","source","style","translateX","translateY","videoRef","onLoadStart","onLoad","payload","duration","onEnd","onProgress","data","currentTime","seekableDuration","onBuffer","_ref","isBuffering","onPlayBackStatusUpdate","playbackStatus","isLoaded","error","console","durationMillis","isPlaying","positionMillis","didJustFinish","isLooping","animatedViewStyles","useAnimatedStyle","xScaleOffset","yScaleOffset","transform","value","scaleX","createElement","View","accessibilityLabel","__self","__source","fileName","lineNumber","columnNumber","isVideoPackageAvailable","Video","onPlaybackStatusUpdate","resizeMode","testID","uri","Spinner","prevProps","nextProps","exports","displayName"],"sources":["AnimatedGalleryVideo.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { StyleSheet, View, ViewStyle } from 'react-native';\nimport type { StyleProp } from 'react-native';\nimport Animated, { useAnimatedStyle } from 'react-native-reanimated';\n\nimport {\n  isVideoPackageAvailable,\n  PlaybackStatus,\n  Video,\n  VideoPayloadData,\n  VideoProgressData,\n  VideoType,\n} from '../../../native';\n\nimport { vw } from '../../../utils/utils';\nimport { Spinner } from '../../Spinner/Spinner';\n\nconst screenWidth = vw(100);\nconst halfScreenWidth = vw(50);\nconst oneEighth = 1 / 8;\n\nexport type AnimatedGalleryVideoType = {\n  attachmentId: string;\n  handleEnd: () => void;\n  handleLoad: (index: string, duration: number) => void;\n  handleProgress: (index: string, progress: number, hasEnd?: boolean) => void;\n  index: number;\n  offsetScale: Animated.SharedValue<number>;\n  paused: boolean;\n  previous: boolean;\n  scale: Animated.SharedValue<number>;\n  screenHeight: number;\n  selected: boolean;\n  shouldRender: boolean;\n  source: { uri: string };\n  translateX: Animated.SharedValue<number>;\n  translateY: Animated.SharedValue<number>;\n  videoRef: React.RefObject<VideoType>;\n  repeat?: boolean;\n  style?: StyleProp<ViewStyle>;\n};\n\nconst styles = StyleSheet.create({\n  activityIndicator: {\n    alignSelf: 'center',\n  },\n  videoPlayer: {\n    height: '100%',\n    width: '100%',\n  },\n});\n\nexport const AnimatedGalleryVideo: React.FC<AnimatedGalleryVideoType> = React.memo(\n  (props) => {\n    const [opacity, setOpacity] = useState<number>(1);\n\n    const {\n      attachmentId,\n      handleEnd,\n      handleLoad,\n      handleProgress,\n      index,\n      offsetScale,\n      paused,\n      previous,\n      repeat,\n      scale,\n      screenHeight,\n      selected,\n      shouldRender,\n      source,\n      style,\n      translateX,\n      translateY,\n      videoRef,\n    } = props;\n\n    const onLoadStart = () => {\n      setOpacity(1);\n    };\n\n    const onLoad = (payload: VideoPayloadData) => {\n      setOpacity(0);\n      handleLoad(attachmentId, payload.duration);\n    };\n\n    const onEnd = () => {\n      handleEnd();\n    };\n\n    const onProgress = (data: VideoProgressData) => {\n      handleProgress(attachmentId, data.currentTime / data.seekableDuration);\n    };\n\n    const onBuffer = ({ isBuffering }: { isBuffering: boolean }) => {\n      if (isBuffering) setOpacity(1);\n      else setOpacity(0);\n    };\n\n    const onPlayBackStatusUpdate = (playbackStatus: PlaybackStatus) => {\n      if (!playbackStatus.isLoaded) {\n        // Update your UI for the unloaded state\n        setOpacity(1);\n        if (playbackStatus.error) {\n          console.error(`Encountered a fatal error during playback: ${playbackStatus.error}`);\n        }\n      } else {\n        // Update your UI for the loaded state\n        setOpacity(0);\n        handleLoad(attachmentId, playbackStatus.durationMillis / 1000);\n        if (playbackStatus.isPlaying) {\n          // Update your UI for the playing state\n          handleProgress(\n            attachmentId,\n            playbackStatus.positionMillis / 1000 / (playbackStatus.durationMillis / 1000),\n          );\n        }\n\n        if (playbackStatus.isBuffering) {\n          // Update your UI for the buffering state\n          setOpacity(1);\n        }\n\n        if (playbackStatus.didJustFinish && !playbackStatus.isLooping) {\n          // The player has just finished playing and will stop. Maybe you want to play something else?\n          handleEnd();\n        }\n      }\n    };\n\n    const animatedViewStyles = useAnimatedStyle<ViewStyle>(() => {\n      const xScaleOffset = -7 * screenWidth * (0.5 + index);\n      const yScaleOffset = -screenHeight * 3.5;\n      return {\n        transform: [\n          {\n            translateX: selected\n              ? translateX.value + xScaleOffset\n              : scale.value < 1 || scale.value !== offsetScale.value\n              ? xScaleOffset\n              : previous\n              ? translateX.value - halfScreenWidth * (scale.value - 1) + xScaleOffset\n              : translateX.value + halfScreenWidth * (scale.value - 1) + xScaleOffset,\n          },\n          {\n            translateY: selected ? translateY.value + yScaleOffset : yScaleOffset,\n          },\n          {\n            scale: selected ? scale.value / 8 : oneEighth,\n          },\n          { scaleX: -1 },\n        ],\n      };\n    }, [previous, selected]);\n\n    /**\n     * An empty view is rendered for images not close to the currently\n     * selected in order to maintain spacing while reducing the image\n     * load on memory.\n     */\n    if (!shouldRender) {\n      return (\n        <View\n          accessibilityLabel='Empty View Image Gallery'\n          style={[style, { transform: [{ scale: oneEighth }] }]}\n        />\n      );\n    }\n\n    return (\n      <Animated.View\n        accessibilityLabel='Image Gallery Video'\n        style={[\n          style,\n          animatedViewStyles,\n          {\n            transform: [\n              { scaleX: -1 },\n              { translateY: -screenHeight * 3.5 },\n              {\n                translateX: -translateX.value + 7 * screenWidth * (0.5 + index),\n              },\n              { scale: oneEighth },\n            ],\n          },\n        ]}\n      >\n        {isVideoPackageAvailable() && (\n          <Video\n            onBuffer={onBuffer}\n            onEnd={onEnd}\n            onLoad={onLoad}\n            onLoadStart={onLoadStart}\n            onPlaybackStatusUpdate={onPlayBackStatusUpdate}\n            onProgress={onProgress}\n            paused={paused}\n            repeat={repeat}\n            resizeMode='contain'\n            style={style}\n            testID='video-player'\n            uri={source.uri}\n            videoRef={videoRef}\n          />\n        )}\n        <Animated.View\n          accessibilityLabel='Spinner'\n          style={[\n            styles.activityIndicator,\n            {\n              opacity,\n              transform: [\n                { scaleX: -1 },\n                { translateY: -screenHeight * 4 },\n                { scale: 1 / oneEighth },\n              ],\n            },\n          ]}\n        >\n          <Spinner height={40} width={40} />\n        </Animated.View>\n      </Animated.View>\n    );\n  },\n\n  (prevProps, nextProps) => {\n    if (\n      prevProps.paused === nextProps.paused &&\n      prevProps.repeat === nextProps.repeat &&\n      prevProps.shouldRender === nextProps.shouldRender &&\n      prevProps.source.uri === nextProps.source.uri &&\n      prevProps.screenHeight === nextProps.screenHeight &&\n      prevProps.selected === nextProps.selected &&\n      prevProps.previous === nextProps.previous &&\n      prevProps.index === nextProps.index\n    ) {\n      return true;\n    }\n    return false;\n  },\n);\n\nAnimatedGalleryVideo.displayName = 'AnimatedGalleryVideo';\n"],"mappings":"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"}