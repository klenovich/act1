{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_Attachment","_MessageContext","_MessagesContext","_ThemeContext","_native","_this","_jsxFileName","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","FILE_PREVIEW_HEIGHT","styles","StyleSheet","create","container","padding","fileContainer","borderRadius","borderWidth","flexDirection","height","justifyContent","paddingLeft","paddingRight","FileAttachmentGroupWithContext","props","Attachment","AudioAttachment","files","messageId","_props$styles","stylesProp","_useState","useState","_useState2","_slicedToArray2","filesToDisplay","setFilesToDisplay","useEffect","map","file","_extends2","duration","paused","progress","onLoad","index","prevFilesToDisplay","fileToDisplay","id","toString","onProgress","currentTime","hasEnd","prevFileUploads","fileUpload","onPlayPause","pausedStatus","_useTheme","useTheme","_useTheme$theme","theme","_useTheme$theme$color","colors","grey_whisper","white","messageSimple","fileAttachmentGroup","createElement","View","style","__self","__source","fileName","lineNumber","columnNumber","paddingBottom","length","attachmentContainer","type","isAudioPackageAvailable","accessibilityLabel","marginBottom","backgroundColor","borderColor","width","item","name","title","uri","asset_url","testID","attachment","areEqual","prevProps","nextProps","prevFiles","nextFiles","MemoizedFileAttachmentGroup","React","memo","FileAttachmentGroup","propFiles","_useMessageContext","useMessageContext","contextFiles","_useMessagesContext","useMessagesContext","_useMessagesContext$A","AttachmentDefault","exports","displayName"],"sources":["FileAttachmentGroup.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { StyleProp, StyleSheet, View, ViewStyle } from 'react-native';\n\nimport type { Attachment } from 'stream-chat';\n\nimport { Attachment as AttachmentDefault } from './Attachment';\n\nimport {\n  MessageContextValue,\n  useMessageContext,\n} from '../../contexts/messageContext/MessageContext';\n\nimport {\n  MessagesContextValue,\n  useMessagesContext,\n} from '../../contexts/messagesContext/MessagesContext';\nimport { useTheme } from '../../contexts/themeContext/ThemeContext';\nimport { isAudioPackageAvailable } from '../../native';\n\nimport type { DefaultStreamChatGenerics } from '../../types/types';\n\nconst FILE_PREVIEW_HEIGHT = 60;\n\nconst styles = StyleSheet.create({\n  container: {\n    padding: 4,\n  },\n  fileContainer: {\n    borderRadius: 12,\n    borderWidth: 1,\n    flexDirection: 'row',\n    height: FILE_PREVIEW_HEIGHT,\n    justifyContent: 'space-between',\n    paddingLeft: 8,\n    paddingRight: 8,\n  },\n});\n\nexport type FileAttachmentGroupPropsWithContext<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Pick<MessageContextValue<StreamChatGenerics>, 'files'> &\n  Pick<MessagesContextValue<StreamChatGenerics>, 'Attachment' | 'AudioAttachment'> & {\n    /**\n     * The unique id for the message with file attachments\n     */\n    messageId: string;\n    styles?: Partial<{\n      attachmentContainer: StyleProp<ViewStyle>;\n      container: StyleProp<ViewStyle>;\n    }>;\n  };\n\ntype FilesToDisplayType<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Attachment<StreamChatGenerics> & {\n  duration: number;\n  paused: boolean;\n  progress: number;\n};\n\nconst FileAttachmentGroupWithContext = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  props: FileAttachmentGroupPropsWithContext<StreamChatGenerics>,\n) => {\n  const { Attachment, AudioAttachment, files, messageId, styles: stylesProp = {} } = props;\n  const [filesToDisplay, setFilesToDisplay] = useState<FilesToDisplayType[]>([]);\n\n  useEffect(() => {\n    setFilesToDisplay(files.map((file) => ({ ...file, duration: 0, paused: true, progress: 0 })));\n  }, [files]);\n\n  // Handler triggered when an audio is loaded in the message input. The initial state is defined for the audio here and the duration is set.\n  const onLoad = (index: string, duration: number) => {\n    setFilesToDisplay((prevFilesToDisplay) =>\n      prevFilesToDisplay.map((fileToDisplay, id) => ({\n        ...fileToDisplay,\n        duration: id.toString() === index ? duration : fileToDisplay.duration,\n      })),\n    );\n  };\n\n  // The handler which is triggered when the audio progresses/ the thumb is dragged in the progress control. The progressed duration is set here.\n  const onProgress = (index: string, currentTime?: number, hasEnd?: boolean) => {\n    setFilesToDisplay((prevFileUploads) =>\n      prevFileUploads.map((fileUpload, id) => ({\n        ...fileUpload,\n        progress:\n          id.toString() === index\n            ? hasEnd\n              ? 1\n              : currentTime\n              ? currentTime / (fileUpload.duration as number)\n              : 0\n            : fileUpload.progress,\n      })),\n    );\n  };\n\n  // The handler which controls or sets the paused/played state of the audio.\n  const onPlayPause = (index: string, pausedStatus?: boolean) => {\n    if (pausedStatus === false) {\n      // If the status is false we set the audio with the index as playing and the others as paused.\n      setFilesToDisplay((prevFileUploads) =>\n        prevFileUploads.map((fileUpload, id) => ({\n          ...fileUpload,\n          paused: id.toString() !== index,\n        })),\n      );\n    } else {\n      // If the status is true we simply set all the audio's paused state as true.\n      setFilesToDisplay((prevFileUploads) =>\n        prevFileUploads.map((fileUpload) => ({\n          ...fileUpload,\n          paused: true,\n        })),\n      );\n    }\n  };\n\n  const {\n    theme: {\n      colors: { grey_whisper, white },\n      messageSimple: {\n        fileAttachmentGroup: { container },\n      },\n    },\n  } = useTheme();\n\n  return (\n    <View style={[styles.container, container, stylesProp.container]}>\n      {filesToDisplay.map((file, index) => (\n        <View\n          key={`${messageId}-${index}`}\n          style={[\n            { paddingBottom: index !== files.length - 1 ? 4 : 0 },\n            stylesProp.attachmentContainer,\n          ]}\n        >\n          {file.type === 'audio' && isAudioPackageAvailable() ? (\n            <View\n              accessibilityLabel='audio-attachment-preview'\n              style={[\n                styles.fileContainer,\n                index === filesToDisplay.length - 1\n                  ? {\n                      marginBottom: 0,\n                    }\n                  : {},\n                {\n                  backgroundColor: white,\n                  borderColor: grey_whisper,\n                  width: -16,\n                },\n              ]}\n            >\n              <AudioAttachment\n                item={{\n                  duration: file.duration,\n                  file: { name: file.title as string, uri: file.asset_url },\n                  id: index.toString(),\n                  paused: file.paused,\n                  progress: file.progress,\n                }}\n                onLoad={onLoad}\n                onPlayPause={onPlayPause}\n                onProgress={onProgress}\n                testID='audio-attachment-preview'\n              />\n            </View>\n          ) : (\n            <Attachment attachment={file} />\n          )}\n        </View>\n      ))}\n    </View>\n  );\n};\n\nconst areEqual = <StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics>(\n  prevProps: FileAttachmentGroupPropsWithContext<StreamChatGenerics>,\n  nextProps: FileAttachmentGroupPropsWithContext<StreamChatGenerics>,\n) => {\n  const { files: prevFiles } = prevProps;\n  const { files: nextFiles } = nextProps;\n\n  return prevFiles.length === nextFiles.length;\n};\n\nconst MemoizedFileAttachmentGroup = React.memo(\n  FileAttachmentGroupWithContext,\n  areEqual,\n) as typeof FileAttachmentGroupWithContext;\n\nexport type FileAttachmentGroupProps<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Partial<Omit<FileAttachmentGroupPropsWithContext<StreamChatGenerics>, 'messageId'>> &\n  Pick<FileAttachmentGroupPropsWithContext<StreamChatGenerics>, 'messageId'>;\n\nexport const FileAttachmentGroup = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  props: FileAttachmentGroupProps<StreamChatGenerics>,\n) => {\n  const { files: propFiles, messageId } = props;\n\n  const { files: contextFiles } = useMessageContext<StreamChatGenerics>();\n\n  const { Attachment = AttachmentDefault, AudioAttachment } =\n    useMessagesContext<StreamChatGenerics>();\n\n  const files = propFiles || contextFiles;\n\n  if (!files.length) return null;\n\n  return (\n    <MemoizedFileAttachmentGroup\n      {...{\n        Attachment,\n        AudioAttachment,\n        files,\n        messageId,\n      }}\n    />\n  );\n};\n\nFileAttachmentGroup.displayName = 'FileAttachmentGroup{messageSimple{fileAttachmentGroup}}';\n"],"mappings":"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"}