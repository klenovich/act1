{"version":3,"names":["getGroupStyles","params","dateSeparators","hideDateSeparators","maxTimeBetweenGroupedMessages","messages","noGroupByUser","userId","messageGroupStyles","messagesFilteredForNonUser","filter","message","_message$user","isMessageTypeDeleted","type","user","id","i","length","_message$user2","_previousMessage$user","_messageGroupStyles$p","_nextMessage$user","previousMessage","nextMessage","groupStyles","isPrevMessageTypeDeleted","isNextMessageTypeDeleted","isTopMessage","includes","isBottomMessage","undefined","created_at","getTime","push","splice","exports"],"sources":["getGroupStyles.ts"],"sourcesContent":["import type { DateSeparators } from './getDateSeparators';\n\nimport type { PaginatedMessageListContextValue } from '../../../contexts/paginatedMessageListContext/PaginatedMessageListContext';\nimport type { ThreadContextValue } from '../../../contexts/threadContext/ThreadContext';\nimport type { DefaultStreamChatGenerics } from '../../../types/types';\nimport type { GroupType } from '../hooks/useMessageList';\n\nexport type GetGroupStylesParams<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  dateSeparators: DateSeparators;\n  messages:\n    | PaginatedMessageListContextValue<StreamChatGenerics>['messages']\n    | ThreadContextValue<StreamChatGenerics>['threadMessages'];\n  hideDateSeparators?: boolean;\n  maxTimeBetweenGroupedMessages?: number;\n  noGroupByUser?: boolean;\n  userId?: string;\n};\n\nexport const getGroupStyles = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  params: GetGroupStylesParams<StreamChatGenerics>,\n) => {\n  const {\n    dateSeparators,\n    hideDateSeparators,\n    maxTimeBetweenGroupedMessages,\n    messages,\n    noGroupByUser,\n    userId,\n  } = params;\n\n  if (noGroupByUser) return {};\n\n  const messageGroupStyles: { [key: string]: GroupType[] } = {};\n\n  const messagesFilteredForNonUser = messages.filter((message) => {\n    const isMessageTypeDeleted = message.type === 'deleted';\n    return !isMessageTypeDeleted || userId === message.user?.id;\n  });\n\n  for (let i = 0; i < messagesFilteredForNonUser.length; i++) {\n    const previousMessage = messagesFilteredForNonUser[i - 1] as\n      | typeof messagesFilteredForNonUser[0]\n      | undefined;\n    const message = messagesFilteredForNonUser[i];\n    const nextMessage = messagesFilteredForNonUser[i + 1] as\n      | typeof messagesFilteredForNonUser[0]\n      | undefined;\n    const groupStyles: GroupType[] = [];\n\n    const isPrevMessageTypeDeleted = previousMessage?.type === 'deleted';\n    const isNextMessageTypeDeleted = nextMessage?.type === 'deleted';\n\n    const userId = message?.user?.id || null;\n\n    const isTopMessage =\n      !previousMessage ||\n      previousMessage.type === 'system' ||\n      userId !== previousMessage?.user?.id ||\n      previousMessage.type === 'error' ||\n      !!isPrevMessageTypeDeleted ||\n      (!hideDateSeparators && dateSeparators[message.id]) ||\n      messageGroupStyles[previousMessage.id]?.includes('bottom');\n\n    const isBottomMessage =\n      !nextMessage ||\n      nextMessage.type === 'system' ||\n      userId !== nextMessage?.user?.id ||\n      nextMessage.type === 'error' ||\n      !!isNextMessageTypeDeleted ||\n      (!hideDateSeparators && dateSeparators[nextMessage.id]) ||\n      (maxTimeBetweenGroupedMessages !== undefined &&\n        nextMessage.created_at.getTime() - message.created_at.getTime() >\n          maxTimeBetweenGroupedMessages);\n\n    /**\n     * Add group styles key for top message\n     */\n    if (isTopMessage) {\n      groupStyles.push('top');\n    }\n\n    /**\n     * Add group styles key for bottom message\n     */\n\n    const isMessageTypeDeleted = message.type === 'deleted';\n    if (isBottomMessage) {\n      /**\n       * If the bottom message is also the top, or deleted, or an error,\n       * add the key for single message instead of bottom\n       */\n      if (isTopMessage || isMessageTypeDeleted || message.type === 'error') {\n        groupStyles.splice(0, groupStyles.length);\n        groupStyles.push('single');\n      } else {\n        groupStyles.push('bottom');\n      }\n    }\n\n    /**\n     * Add the key for all non top or bottom messages, if the message is\n     * deleted or an error add the key for single otherwise middle\n     */\n    if (!isTopMessage && !isBottomMessage) {\n      if (isMessageTypeDeleted || message.type === 'error') {\n        groupStyles.splice(0, groupStyles.length);\n        groupStyles.push('single');\n      } else {\n        groupStyles.splice(0, groupStyles.length);\n        groupStyles.push('middle');\n      }\n    }\n\n    if (message.id) {\n      messageGroupStyles[message.id] = groupStyles;\n    }\n  }\n\n  return messageGroupStyles;\n};\n"],"mappings":"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"}