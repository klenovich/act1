{"version":3,"names":["getDateSeparators","params","deletedMessagesVisibilityType","hideDateSeparators","messages","userId","dateSeparators","messagesWithoutDeleted","filter","message","_message$user","isMessageTypeDeleted","type","isDeletedMessageVisibleToSender","user","id","i","length","previousMessage","messageDate","created_at","toDateString","prevMessageDate","exports"],"sources":["getDateSeparators.ts"],"sourcesContent":["import type { DeletedMessagesVisibilityType } from '../../../contexts/messagesContext/MessagesContext';\nimport type { PaginatedMessageListContextValue } from '../../../contexts/paginatedMessageListContext/PaginatedMessageListContext';\nimport type { ThreadContextValue } from '../../../contexts/threadContext/ThreadContext';\nimport type { DefaultStreamChatGenerics } from '../../../types/types';\n\nexport type GetDateSeparatorsParams<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  messages:\n    | PaginatedMessageListContextValue<StreamChatGenerics>['messages']\n    | ThreadContextValue<StreamChatGenerics>['threadMessages'];\n  deletedMessagesVisibilityType?: DeletedMessagesVisibilityType;\n  hideDateSeparators?: boolean;\n  userId?: string;\n};\n\nexport type DateSeparators = {\n  [key: string]: Date;\n};\n\nexport const getDateSeparators = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  params: GetDateSeparatorsParams<StreamChatGenerics>,\n) => {\n  const { deletedMessagesVisibilityType, hideDateSeparators, messages, userId } = params;\n  const dateSeparators: DateSeparators = {};\n\n  if (hideDateSeparators) {\n    return dateSeparators;\n  }\n\n  const messagesWithoutDeleted = messages.filter((message) => {\n    const isMessageTypeDeleted = message.type === 'deleted';\n\n    const isDeletedMessageVisibleToSender =\n      deletedMessagesVisibilityType === 'sender' || deletedMessagesVisibilityType === 'always';\n\n    return (\n      !isMessageTypeDeleted || (userId === message.user?.id && isDeletedMessageVisibleToSender)\n    );\n  });\n\n  for (let i = 0; i < messagesWithoutDeleted.length; i++) {\n    const previousMessage = messagesWithoutDeleted[i - 1];\n    const message = messagesWithoutDeleted[i];\n\n    const messageDate = message.created_at.toDateString();\n\n    const prevMessageDate = previousMessage\n      ? previousMessage.created_at.toDateString()\n      : messageDate;\n\n    if (i === 0 || messageDate !== prevMessageDate) {\n      dateSeparators[message.id] = message.created_at;\n    }\n  }\n\n  return dateSeparators;\n};\n"],"mappings":";;;;AAoBO,IAAMA,iBAAiB,GAAG,SAApBA,iBAAiBA,CAG5BC,MAAmD,EAChD;EACH,IAAQC,6BAA6B,GAA2CD,MAAM,CAA9EC,6BAA6B;IAAEC,kBAAkB,GAAuBF,MAAM,CAA/CE,kBAAkB;IAAEC,QAAQ,GAAaH,MAAM,CAA3BG,QAAQ;IAAEC,MAAM,GAAKJ,MAAM,CAAjBI,MAAM;EAC3E,IAAMC,cAA8B,GAAG,CAAC,CAAC;EAEzC,IAAIH,kBAAkB,EAAE;IACtB,OAAOG,cAAc;EACvB;EAEA,IAAMC,sBAAsB,GAAGH,QAAQ,CAACI,MAAM,CAAC,UAACC,OAAO,EAAK;IAAA,IAAAC,aAAA;IAC1D,IAAMC,oBAAoB,GAAGF,OAAO,CAACG,IAAI,KAAK,SAAS;IAEvD,IAAMC,+BAA+B,GACnCX,6BAA6B,KAAK,QAAQ,IAAIA,6BAA6B,KAAK,QAAQ;IAE1F,OACE,CAACS,oBAAoB,IAAKN,MAAM,OAAAK,aAAA,GAAKD,OAAO,CAACK,IAAI,qBAAZJ,aAAA,CAAcK,EAAE,KAAIF,+BAAgC;EAE7F,CAAC,CAAC;EAEF,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGT,sBAAsB,CAACU,MAAM,EAAED,CAAC,EAAE,EAAE;IACtD,IAAME,eAAe,GAAGX,sBAAsB,CAACS,CAAC,GAAG,CAAC,CAAC;IACrD,IAAMP,OAAO,GAAGF,sBAAsB,CAACS,CAAC,CAAC;IAEzC,IAAMG,WAAW,GAAGV,OAAO,CAACW,UAAU,CAACC,YAAY,CAAC,CAAC;IAErD,IAAMC,eAAe,GAAGJ,eAAe,GACnCA,eAAe,CAACE,UAAU,CAACC,YAAY,CAAC,CAAC,GACzCF,WAAW;IAEf,IAAIH,CAAC,KAAK,CAAC,IAAIG,WAAW,KAAKG,eAAe,EAAE;MAC9ChB,cAAc,CAACG,OAAO,CAACM,EAAE,CAAC,GAAGN,OAAO,CAACW,UAAU;IACjD;EACF;EAEA,OAAOd,cAAc;AACvB,CAAC;AAACiB,OAAA,CAAAvB,iBAAA,GAAAA,iBAAA"}